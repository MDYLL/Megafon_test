{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {
    "colab_type": "text",
    "id": "view-in-github"
   },
   "source": [
    "<a href=\"https://colab.research.google.com/github/MDYLL/Megafon_test/blob/master/Megafon_test.ipynb\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 164,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "QAH_T0bO_6ql"
   },
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import torch\n",
    "import random\n",
    "import numpy as np\n",
    "\n",
    "random.seed(0)\n",
    "np.random.seed(0)\n",
    "torch.manual_seed(0)\n",
    "torch.cuda.manual_seed(0)\n",
    "torch.backends.cudnn.deterministic = True"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 165,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "nI5O10DHAEH4"
   },
   "outputs": [],
   "source": [
    "df=pd.read_csv('C:/Users/User/Megafon/02_Data.csv',sep=';')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 166,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 195
    },
    "colab_type": "code",
    "id": "lRhyMxNqAhST",
    "outputId": "2ff01eb7-4bc7-43d5-aee0-7de421121da3"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>lac</th>\n",
       "      <th>cid</th>\n",
       "      <th>msisdn</th>\n",
       "      <th>imei</th>\n",
       "      <th>event_type</th>\n",
       "      <th>tstamp</th>\n",
       "      <th>long</th>\n",
       "      <th>lat</th>\n",
       "      <th>max_dist</th>\n",
       "      <th>cell_type</th>\n",
       "      <th>start_angle</th>\n",
       "      <th>end_angle</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>5029</td>\n",
       "      <td>40798</td>\n",
       "      <td>158529599791</td>\n",
       "      <td>3.531111e+14</td>\n",
       "      <td>0</td>\n",
       "      <td>1369252800974</td>\n",
       "      <td>37.9305</td>\n",
       "      <td>55.7815</td>\n",
       "      <td>2101</td>\n",
       "      <td>OUTDOOR</td>\n",
       "      <td>220.0</td>\n",
       "      <td>280.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>7782</td>\n",
       "      <td>56870</td>\n",
       "      <td>158520145943</td>\n",
       "      <td>1.292900e+13</td>\n",
       "      <td>5</td>\n",
       "      <td>1369252801396</td>\n",
       "      <td>37.4239</td>\n",
       "      <td>55.7426</td>\n",
       "      <td>2</td>\n",
       "      <td>OUTDOOR</td>\n",
       "      <td>45.0</td>\n",
       "      <td>105.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>7794</td>\n",
       "      <td>32226</td>\n",
       "      <td>158521798391</td>\n",
       "      <td>3.519940e+14</td>\n",
       "      <td>5</td>\n",
       "      <td>1369252802013</td>\n",
       "      <td>37.7034</td>\n",
       "      <td>55.5803</td>\n",
       "      <td>1125</td>\n",
       "      <td>OUTDOOR</td>\n",
       "      <td>0.0</td>\n",
       "      <td>60.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>7758</td>\n",
       "      <td>33528</td>\n",
       "      <td>158537830573</td>\n",
       "      <td>3.586270e+14</td>\n",
       "      <td>0</td>\n",
       "      <td>1369252802331</td>\n",
       "      <td>37.7895</td>\n",
       "      <td>55.7042</td>\n",
       "      <td>1158</td>\n",
       "      <td>OUTDOOR</td>\n",
       "      <td>210.0</td>\n",
       "      <td>270.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5060</td>\n",
       "      <td>17568</td>\n",
       "      <td>158510204039</td>\n",
       "      <td>3.524581e+14</td>\n",
       "      <td>8</td>\n",
       "      <td>1369252803586</td>\n",
       "      <td>37.1900</td>\n",
       "      <td>55.8308</td>\n",
       "      <td>500</td>\n",
       "      <td>OUTDOOR</td>\n",
       "      <td>180.0</td>\n",
       "      <td>240.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "    lac    cid        msisdn          imei  event_type         tstamp  \\\n",
       "0  5029  40798  158529599791  3.531111e+14           0  1369252800974   \n",
       "1  7782  56870  158520145943  1.292900e+13           5  1369252801396   \n",
       "2  7794  32226  158521798391  3.519940e+14           5  1369252802013   \n",
       "3  7758  33528  158537830573  3.586270e+14           0  1369252802331   \n",
       "4  5060  17568  158510204039  3.524581e+14           8  1369252803586   \n",
       "\n",
       "      long      lat  max_dist cell_type  start_angle  end_angle  \n",
       "0  37.9305  55.7815      2101   OUTDOOR        220.0      280.0  \n",
       "1  37.4239  55.7426         2   OUTDOOR         45.0      105.0  \n",
       "2  37.7034  55.5803      1125   OUTDOOR          0.0       60.0  \n",
       "3  37.7895  55.7042      1158   OUTDOOR        210.0      270.0  \n",
       "4  37.1900  55.8308       500   OUTDOOR        180.0      240.0  "
      ]
     },
     "execution_count": 166,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 167,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 34
    },
    "colab_type": "code",
    "id": "jJBBcsxBXbMA",
    "outputId": "e978ae67-9db9-4a3c-ddea-b65d1ec90251"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "174123"
      ]
     },
     "execution_count": 167,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.shape[0]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 168,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 50
    },
    "colab_type": "code",
    "id": "Z6sjy3jQ53J5",
    "outputId": "6a9c510e-cd1a-412d-873f-913657261f42"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(Timestamp('2013-05-22 20:00:00.974000'),\n",
       " Timestamp('2013-05-30 16:29:37.643000'))"
      ]
     },
     "execution_count": 168,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pd.to_datetime(df.tstamp.min(), unit='ms'),pd.to_datetime(df.tstamp.max(), unit='ms')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 169,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 34
    },
    "colab_type": "code",
    "id": "EorO3DZ9g5nD",
    "outputId": "5f35fa09-99e1-4887-84e2-cd78544bd6a7"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "Timestamp('2013-05-24 15:27:08.852000')"
      ]
     },
     "execution_count": 169,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "pd.to_datetime(1369409228852, unit='ms')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 170,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "A9RIuQAQQsMF"
   },
   "outputs": [],
   "source": [
    "df=df.drop(['lac','cid','imei','event_type','max_dist','cell_type','start_angle','end_angle'],axis=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 171,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "TJW4RJxkRPqX"
   },
   "outputs": [],
   "source": [
    "df.tstamp//=1000\n",
    "df.tstamp-=df.tstamp.min(axis=0)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 172,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "ZZrA5PiKW4Tp"
   },
   "outputs": [],
   "source": [
    "period=df.tstamp.max(axis=0)//1000\n",
    "y=[]\n",
    "for i in range(1000):\n",
    "  y.append(df.loc[(df.tstamp>i*period)&(df.tstamp<=(i+1)*period)].shape[0])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 173,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 266
    },
    "colab_type": "code",
    "id": "vqddnxjMXGKU",
    "outputId": "4336bd08-6a3e-41c7-ccd5-5a443527a184"
   },
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    }
   ],
   "source": [
    "from matplotlib import pyplot as plt\n",
    "plt.plot(y)\n",
    "plt.show()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 174,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 34
    },
    "colab_type": "code",
    "id": "MGKbTFxuCnrC",
    "outputId": "f7eddd3c-a941-42bc-937d-f18bcb2161cb"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "2361"
      ]
     },
     "execution_count": 174,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "unique_numbers=df['msisdn'].unique()\n",
    "len(unique_numbers)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 175,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "fa6Irs5vRyBe"
   },
   "outputs": [],
   "source": [
    "quantity_time_intervals=100\n",
    "min_tstamp=df.tstamp.min(axis=0)\n",
    "max_tstamp=df.tstamp.max(axis=0)\n",
    "time_period=(max_tstamp-min_tstamp)//quantity_time_intervals\n",
    "# time_intervals=[el for el in range(0,max_tstamp,time_period)]\n",
    "df_norm=pd.DataFrame(columns=df.columns)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 176,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 402
    },
    "colab_type": "code",
    "id": "44S1RsPUeWte",
    "outputId": "e6526080-75ab-4e29-8d34-6d8c7919a55a"
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>msisdn</th>\n",
       "      <th>tstamp</th>\n",
       "      <th>long</th>\n",
       "      <th>lat</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>158529599791</td>\n",
       "      <td>0</td>\n",
       "      <td>37.9305</td>\n",
       "      <td>55.7815</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>158520145943</td>\n",
       "      <td>1</td>\n",
       "      <td>37.4239</td>\n",
       "      <td>55.7426</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>158521798391</td>\n",
       "      <td>2</td>\n",
       "      <td>37.7034</td>\n",
       "      <td>55.5803</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>158537830573</td>\n",
       "      <td>2</td>\n",
       "      <td>37.7895</td>\n",
       "      <td>55.7042</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>158510204039</td>\n",
       "      <td>3</td>\n",
       "      <td>37.1900</td>\n",
       "      <td>55.8308</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174118</th>\n",
       "      <td>158503851673</td>\n",
       "      <td>673967</td>\n",
       "      <td>37.6178</td>\n",
       "      <td>55.7370</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174119</th>\n",
       "      <td>158503851673</td>\n",
       "      <td>674287</td>\n",
       "      <td>37.6217</td>\n",
       "      <td>55.7363</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174120</th>\n",
       "      <td>158503851673</td>\n",
       "      <td>675316</td>\n",
       "      <td>37.6217</td>\n",
       "      <td>55.7363</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174121</th>\n",
       "      <td>158503851673</td>\n",
       "      <td>678091</td>\n",
       "      <td>37.7856</td>\n",
       "      <td>55.7508</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>174122</th>\n",
       "      <td>158503851673</td>\n",
       "      <td>678577</td>\n",
       "      <td>37.3426</td>\n",
       "      <td>55.4158</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>174123 rows Ã— 4 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "              msisdn  tstamp     long      lat\n",
       "0       158529599791       0  37.9305  55.7815\n",
       "1       158520145943       1  37.4239  55.7426\n",
       "2       158521798391       2  37.7034  55.5803\n",
       "3       158537830573       2  37.7895  55.7042\n",
       "4       158510204039       3  37.1900  55.8308\n",
       "...              ...     ...      ...      ...\n",
       "174118  158503851673  673967  37.6178  55.7370\n",
       "174119  158503851673  674287  37.6217  55.7363\n",
       "174120  158503851673  675316  37.6217  55.7363\n",
       "174121  158503851673  678091  37.7856  55.7508\n",
       "174122  158503851673  678577  37.3426  55.4158\n",
       "\n",
       "[174123 rows x 4 columns]"
      ]
     },
     "execution_count": 176,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 177,
   "metadata": {
    "colab": {
     "base_uri": "https://localhost:8080/",
     "height": 34
    },
    "colab_type": "code",
    "id": "7g79XACheP0N",
    "outputId": "298dfbbe-9b77-4547-e69e-ad3b9b3d6a55"
   },
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(0, 678577, 6785)"
      ]
     },
     "execution_count": 177,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "min_tstamp,max_tstamp,time_period"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 178,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "n_FF7PwjIaqd"
   },
   "outputs": [],
   "source": [
    "import collections\n",
    "current_tstamp=collections.defaultdict(tuple)\n",
    "for number in unique_numbers:\n",
    "  df1=df.loc[df.msisdn==number]\n",
    "  idx=df1.tstamp.idxmax()\n",
    "  current_tstamp[number]=(df.at[idx,'long'],df.at[idx,'lat'])\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 179,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "cfOUqHbaY0YO"
   },
   "outputs": [
    {
     "ename": "KeyboardInterrupt",
     "evalue": "",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mKeyboardInterrupt\u001b[0m                         Traceback (most recent call last)",
      "\u001b[1;32m<ipython-input-179-0c2542b70746>\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[0;32m      2\u001b[0m \u001b[1;32mfor\u001b[0m \u001b[0mnumber\u001b[0m \u001b[1;32min\u001b[0m \u001b[0munique_numbers\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      3\u001b[0m   \u001b[1;32mfor\u001b[0m \u001b[0mi\u001b[0m \u001b[1;32min\u001b[0m \u001b[0mrange\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;36m0\u001b[0m\u001b[1;33m,\u001b[0m\u001b[0mquantity_time_intervals\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m----> 4\u001b[1;33m     \u001b[0mdf1\u001b[0m\u001b[1;33m=\u001b[0m\u001b[0mdf\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mloc\u001b[0m\u001b[1;33m[\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdf\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mmsisdn\u001b[0m\u001b[1;33m==\u001b[0m\u001b[0mnumber\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m&\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdf\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mtstamp\u001b[0m\u001b[1;33m<=\u001b[0m\u001b[0mmax_tstamp\u001b[0m\u001b[1;33m-\u001b[0m\u001b[0mi\u001b[0m\u001b[1;33m*\u001b[0m\u001b[0mtime_period\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m&\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdf\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mtstamp\u001b[0m\u001b[1;33m>\u001b[0m\u001b[0mmax_tstamp\u001b[0m\u001b[1;33m-\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mi\u001b[0m\u001b[1;33m+\u001b[0m\u001b[1;36m1\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m*\u001b[0m\u001b[0mtime_period\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m      5\u001b[0m     \u001b[1;32mif\u001b[0m \u001b[0mdf1\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0msize\u001b[0m\u001b[1;33m>\u001b[0m\u001b[1;36m0\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m      6\u001b[0m       \u001b[0midx\u001b[0m\u001b[1;33m=\u001b[0m\u001b[0mdf1\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mtstamp\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0midxmax\u001b[0m\u001b[1;33m(\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;32m~\\Anaconda3\\envs\\learnpytorch\\lib\\site-packages\\pandas\\core\\ops\\__init__.py\u001b[0m in \u001b[0;36mwrapper\u001b[1;34m(self, other, axis)\u001b[0m\n\u001b[0;32m   1227\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m   1228\u001b[0m             \u001b[1;32mwith\u001b[0m \u001b[0mnp\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0merrstate\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mall\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;34m\"ignore\"\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m-> 1229\u001b[1;33m                 \u001b[0mres\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mna_op\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mvalues\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mother\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m   1230\u001b[0m             \u001b[1;32mif\u001b[0m \u001b[0mis_scalar\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mres\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m   1231\u001b[0m                 raise TypeError(\n",
      "\u001b[1;32m~\\Anaconda3\\envs\\learnpytorch\\lib\\site-packages\\pandas\\core\\ops\\__init__.py\u001b[0m in \u001b[0;36mna_op\u001b[1;34m(x, y)\u001b[0m\n\u001b[0;32m   1113\u001b[0m             \u001b[1;32mif\u001b[0m \u001b[0mmethod\u001b[0m \u001b[1;32mis\u001b[0m \u001b[1;32mnot\u001b[0m \u001b[1;32mNone\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m   1114\u001b[0m                 \u001b[1;32mwith\u001b[0m \u001b[0mnp\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0merrstate\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mall\u001b[0m\u001b[1;33m=\u001b[0m\u001b[1;34m\"ignore\"\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m-> 1115\u001b[1;33m                     \u001b[0mresult\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mmethod\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0my\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m   1116\u001b[0m                 \u001b[1;32mif\u001b[0m \u001b[0mresult\u001b[0m \u001b[1;32mis\u001b[0m \u001b[0mNotImplemented\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m   1117\u001b[0m                     \u001b[1;32mreturn\u001b[0m \u001b[0minvalid_comparison\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mx\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0my\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mop\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n",
      "\u001b[1;31mKeyboardInterrupt\u001b[0m: "
     ]
    }
   ],
   "source": [
    "df_norm=pd.DataFrame(columns=df.columns)\n",
    "for number in unique_numbers:\n",
    "  for i in range(0,quantity_time_intervals):\n",
    "    df1=df.loc[(df.msisdn==number)&(df.tstamp<=max_tstamp-i*time_period)&(df.tstamp>max_tstamp-(i+1)*time_period)]\n",
    "    if df1.size>0:\n",
    "      idx=df1.tstamp.idxmax()\n",
    "      df_norm=df_norm.append({'msisdn':int(number),'tstamp':i,'long':df1.at[idx,'long'],'lat':df1.at[idx,'lat']},ignore_index=True)\n",
    "      current_tstamp[number]=(df1.at[idx,'long'],df1.at[idx,'lat'])\n",
    "    else:\n",
    "      df_norm=df_norm.append({'msisdn':int(number),'tstamp':i,'long':current_tstamp[number][0],'lat':current_tstamp[number][1]},ignore_index=True)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "ZDcAdtHjQyPr"
   },
   "outputs": [],
   "source": [
    "df_norm=df_norm.astype({'msisdn':'int64','tstamp':'int64'})\n",
    "df_norm.loc[df_norm.msisdn==158529599791]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "fi6WnSIrgN_u"
   },
   "outputs": [],
   "source": [
    "import torch\n",
    "(int(len(unique_numbers)*(len(unique_numbers)-1)/2),2*2*quantity_time_intervals)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "kg1i4rUfkO2Q"
   },
   "outputs": [],
   "source": [
    "x=torch.zeros((int(len(unique_numbers)*(len(unique_numbers)-1)/2),2*2*quantity_time_intervals))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "voV-6Ly_kY3N"
   },
   "outputs": [],
   "source": [
    "x.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "i=unique_numbers[0]\n",
    "df_norm"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "bxg3EfxRka_M"
   },
   "outputs": [],
   "source": [
    "idx=0\n",
    "for i in unique_numbers:\n",
    "  print(i,end=' ')\n",
    "  for j in unique_numbers:\n",
    "    if i<=j:\n",
    "      continue\n",
    "    t1=torch.FloatTensor(df_norm.loc[df_norm.msisdn==i]['long'].values,)\n",
    "    t2=torch.FloatTensor(df_norm.loc[df_norm.msisdn==i]['lat'].values)\n",
    "    t3=torch.FloatTensor(df_norm.loc[df_norm.msisdn==j]['long'].values)\n",
    "    t4=torch.FloatTensor(df_norm.loc[df_norm.msisdn==j]['lat'].values)\n",
    "    t=torch.cat([t1,t2,t3,t4])\n",
    "    x[idx]=t\n",
    "    idx+=1\n",
    "    \n",
    "    "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "Rekvfmo-wmct"
   },
   "outputs": [],
   "source": [
    "x"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "xzjjemFo0SqG"
   },
   "outputs": [],
   "source": [
    "x.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "reR4dudkL1f6"
   },
   "outputs": [],
   "source": [
    "pair=[]\n",
    "idx=0\n",
    "for i in unique_numbers:\n",
    "  # print(i,end=' ')\n",
    "  for j in unique_numbers:\n",
    "    if i<=j:\n",
    "      continue\n",
    "    pair.append((i,j))\n",
    "    # idx+=1\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "y9xP-tNmN0xB"
   },
   "outputs": [],
   "source": [
    "pair_back={(pair[i][0],pair[i][1]):i for i in range(len(pair))}"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "mlzdZLQUT-JO"
   },
   "outputs": [],
   "source": [
    "# uploaded = files.upload()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "cNp9UbTtT-OP"
   },
   "outputs": [],
   "source": [
    "# df=pd.read_csv('C:/Users/User/Megafon/02_Data.csv',sep=';')\n",
    "df=pd.read_csv('C:/Users/User/Megafon/facts.csv',sep=';')"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "nSs5qXvQT-Sf"
   },
   "outputs": [],
   "source": [
    "label=[]\n",
    "for row in df.iterrows():\n",
    "  label.append((max(row[1][0],row[1][1]),min(row[1][0],row[1][1])))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "V5ct59adT-XP"
   },
   "outputs": [],
   "source": [
    "true_label=[]\n",
    "for el in label:\n",
    "  try:\n",
    "    num=pair_back[el]\n",
    "    true_label.append(el)\n",
    "  except:\n",
    "    print(el)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "naAtwEdyT-cs"
   },
   "outputs": [],
   "source": [
    "label=true_label\n",
    "len(label)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "l4zp_7N5c1FI"
   },
   "outputs": [],
   "source": [
    "numbers_of_labels=[]\n",
    "for el in label:\n",
    "  numbers_of_labels.append(pair_back[el])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "gM1bQ4HXRe23"
   },
   "outputs": [],
   "source": [
    "numbers_of_labels[0:3]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "PhVUZDfzKSV8"
   },
   "outputs": [],
   "source": [
    "x_label=x[numbers_of_labels]\n",
    "x_label.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "A0H8XwneLyAU"
   },
   "outputs": [],
   "source": [
    "x0=torch.zeros((x.shape[0],1))\n",
    "for i in range(x0.shape[0]):\n",
    "  if i in numbers_of_labels:\n",
    "    x0[i][0]=1"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "W4Zo9p3esJnX"
   },
   "outputs": [],
   "source": [
    "import numpy as np\n",
    "x_fake=torch.zeros((1200000,x.shape[1]))\n",
    "for i in range(len(numbers_of_labels)):\n",
    "  for j in range(10000):\n",
    "    x_fake[i*10000+j]=x[numbers_of_labels[i]]+torch.tensor(np.random.sample(1)/1000)\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "x[numbers_of_labels[0]][:10]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "x_fake[0][:10]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "05ul188XMDtD"
   },
   "outputs": [],
   "source": [
    "x1=torch.ones((x_fake.shape[0]),1)\n",
    "x_fake1=torch.cat((x_fake,x1),dim=1)\n",
    "x_fake1[:,-1]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "46dTy1QRMt4R"
   },
   "outputs": [],
   "source": [
    "no_label=list(set(range(x.shape[0]))-set(numbers_of_labels))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "BYBMzQ3cM6xf"
   },
   "outputs": [],
   "source": [
    "len(no_label)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "GlicRoHXM9Pb"
   },
   "outputs": [],
   "source": [
    "numbers_of_labels[0] in no_label"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "qhAVYCkXTY4U"
   },
   "outputs": [],
   "source": [
    "x_with_labels=torch.cat((x,x0),dim=1)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "p2tqd5z_Tvnj"
   },
   "outputs": [],
   "source": [
    "x_with_labels[numbers_of_labels[0]][-1]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "d8t_82uiNcmq"
   },
   "outputs": [],
   "source": [
    "x1=x_with_labels[torch.randperm(x_with_labels.shape[0])]\n",
    "x2=x1[:int(x_with_labels.shape[0]*0.8)]\n",
    "x3=x1[int(x_with_labels.shape[0]*0.8):]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "Go9iwVeDO56g"
   },
   "outputs": [],
   "source": [
    "sum(x2[:,-1]),sum(x3[:,-1])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "Mw7GHAcryH-W"
   },
   "outputs": [],
   "source": [
    "x4=torch.cat((x2,x_fake1),dim=0)\n",
    "x4.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "V0Zt3MubUwIX"
   },
   "outputs": [],
   "source": [
    "X_train=x4[:,:-1]\n",
    "X_test=x3[:,:-1]\n",
    "y_train=x4[:,-1]\n",
    "y_test=x3[:,-1]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "kpPL-7zGe82f"
   },
   "outputs": [],
   "source": [
    "sum(y_train)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "2OJHXkOaVljo"
   },
   "outputs": [],
   "source": [
    "X_train.shape,X_test.shape,y_train.shape,y_test.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "9hvWsQ30ah3C"
   },
   "outputs": [],
   "source": [
    "device = torch.device(\"cuda\" if torch.cuda.is_available() else \"cpu\")\n",
    "X_train.to(device)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "gSe5iAp3VuL0"
   },
   "outputs": [],
   "source": [
    "class MegafonNet(torch.nn.Module):\n",
    "  def __init__(self,n_hidden_neurons):\n",
    "    super(MegafonNet,self).__init__()\n",
    "\n",
    "    self.fc1=torch.nn.Linear(quantity_time_intervals*4,n_hidden_neurons)\n",
    "    self.activ1=torch.nn.Sigmoid()\n",
    "    self.fc2=torch.nn.Linear(n_hidden_neurons,n_hidden_neurons)\n",
    "    self.activ2=torch.nn.Tanh()\n",
    "    self.fc3=torch.nn.Linear(n_hidden_neurons,1)\n",
    "    self.activ3=torch.nn.Sigmoid()\n",
    "  \n",
    "  def forward(self,x):\n",
    "    x=self.fc1(x)\n",
    "    x=self.activ1(x)\n",
    "    x=self.fc2(x)\n",
    "    x=self.activ2(x)\n",
    "    x=self.fc3(x)\n",
    "    x=self.activ3(x)\n",
    "    return x\n",
    "\n",
    "megafon_net=MegafonNet(200)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "Jot4NUjiZmLn"
   },
   "outputs": [],
   "source": [
    "loss = torch.nn.BCELoss()\n",
    "\n",
    "optimizer = torch.optim.Adam(megafon_net.parameters(), \n",
    "                             lr=1.0e-3,weight_decay=0.00)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "QsEJAC4QZ0TR"
   },
   "outputs": [],
   "source": [
    "batch_size = 1000\n",
    "\n",
    "for epoch in range(50000):\n",
    "    order = torch.randperm(len(X_train))\n",
    "    total_loss=0\n",
    "    total_loss_test=0\n",
    "    iter=0\n",
    "    iter_test=0\n",
    "    train_preds=0\n",
    "    for start_index in range(0, len(X_train), batch_size):\n",
    "        # print(start_index/len(X_train))\n",
    "        optimizer.zero_grad()\n",
    "        \n",
    "        batch_indexes = order[start_index:start_index+batch_size]\n",
    "        \n",
    "        x_batch = X_train[batch_indexes]\n",
    "        y_batch = y_train[batch_indexes]\n",
    "        \n",
    "        preds = megafon_net.forward(x_batch)\n",
    "        \n",
    "        loss_value = loss(preds[:,0], y_batch)\n",
    "        total_loss+=loss_value\n",
    "        iter+=1\n",
    "        loss_value.backward()\n",
    "        \n",
    "        optimizer.step()\n",
    "        \n",
    "    order = torch.randperm(len(X_test))\n",
    "    for start_index in range(0,len(X_test),batch_size):\n",
    "        batch_indexes = order[start_index:start_index+batch_size]\n",
    "        \n",
    "        x_batch = X_test[batch_indexes]\n",
    "        y_batch = y_test[batch_indexes]\n",
    "        \n",
    "        preds = megafon_net.forward(x_batch)\n",
    "        \n",
    "        loss_value = loss(preds[:,0], y_batch)\n",
    "        total_loss_test+=loss_value\n",
    "        iter_test+=1\n",
    "        \n",
    "    if epoch % 1 == 0:\n",
    "        print(megafon_net.forward(X_train[-10:-1]))\n",
    "#         test_preds = megafon_net.forward(X_test)\n",
    "        print(\"train loss=\",total_loss/iter)\n",
    "        print(\"test loss=\",total_lost_test/iter_test)\n",
    "#         test_preds = test_preds.argmax(dim=1)\n",
    "#         print(sum(test_preds))\n",
    "        "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": 148,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(torch.Size([1000]), torch.Size([1000]))"
      ]
     },
     "execution_count": 148,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "preds[:,0].shape,y_batch.shape"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 123,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "tensor([0.8503, 0.2298], grad_fn=<SigmoidBackward>)"
      ]
     },
     "execution_count": 123,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "megafon_net.forward(X_train[-1])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 74,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "tensor(0.8483, grad_fn=<NllLossBackward>)"
      ]
     },
     "execution_count": 74,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "loss(preds, y_batch)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 58,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "tensor([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0,\n",
       "        0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0,\n",
       "        0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,\n",
       "        0, 1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 0,\n",
       "        0, 1, 0, 0])"
      ]
     },
     "execution_count": 58,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "y_batch"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {
    "colab": {},
    "colab_type": "code",
    "id": "zQIs0xwHfxmK"
   },
   "outputs": [
    {
     "ename": "NameError",
     "evalue": "name 'test_preds' is not defined",
     "output_type": "error",
     "traceback": [
      "\u001b[1;31m---------------------------------------------------------------------------\u001b[0m",
      "\u001b[1;31mNameError\u001b[0m                                 Traceback (most recent call last)",
      "\u001b[1;32m<ipython-input-1-c091ace71fea>\u001b[0m in \u001b[0;36m<module>\u001b[1;34m\u001b[0m\n\u001b[1;32m----> 1\u001b[1;33m \u001b[0msum\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mtest_preds\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m",
      "\u001b[1;31mNameError\u001b[0m: name 'test_preds' is not defined"
     ]
    }
   ],
   "source": [
    "sum(test_preds)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "accelerator": "GPU",
  "colab": {
   "authorship_tag": "ABX9TyPu/R9KoebqxSPH3f9Hjcku",
   "collapsed_sections": [],
   "include_colab_link": true,
   "machine_shape": "hm",
   "name": "Megafon_test.ipynb",
   "provenance": []
  },
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.5"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 1
}
